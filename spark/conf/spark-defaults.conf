# Spark default configurations for NYC Taxi Lakehouse project

# Application configuration
spark.app.name                             NYC-Taxi-Lakehouse
spark.master                               spark://spark-master:7077

# Executor configuration
spark.executor.memory                      4g
spark.executor.cores                       2
spark.executor.instances                   2

# Driver configuration
spark.driver.memory                        4g
spark.driver.maxResultSize                 2g

# Runtime configuration
spark.sql.adaptive.enabled                 true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.adaptive.skewJoin.enabled        true
spark.sql.shuffle.partitions               10
spark.default.parallelism                  10

# Storage configuration
spark.sql.warehouse.dir                    s3a://lake/spark-warehouse
spark.sql.extensions                       io.delta.sql.DeltaSparkSessionExtension
spark.sql.catalog.spark_catalog            org.apache.spark.sql.delta.catalog.DeltaCatalog
spark.delta.logStore.class                 org.apache.spark.sql.delta.storage.S3SingleDriverLogStore

# File format configuration
spark.sql.parquet.compression.codec        snappy
spark.sql.parquet.mergeSchema              true
spark.sql.parquet.filterPushdown           true
spark.sql.hive.metastorePartitionPruning   true

# Serialization
spark.serializer                           org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer.max            1024m

# MinIO/S3 configuration
spark.hadoop.fs.s3a.endpoint               http://minio:9000
spark.hadoop.fs.s3a.access.key             minio
spark.hadoop.fs.s3a.secret.key             minio12345
spark.hadoop.fs.s3a.path.style.access      true
spark.hadoop.fs.s3a.impl                   org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.connection.ssl.enabled false
spark.hadoop.fs.s3a.fast.upload            true
spark.hadoop.fs.s3a.committer.name         directory

# History server
spark.eventLog.enabled                     true
spark.eventLog.dir                         s3a://lake/spark-events
spark.history.fs.logDirectory              s3a://lake/spark-events

# Memory configuration
spark.memory.fraction                      0.8
spark.memory.storageFraction               0.3

# Performance
spark.speculation                          true
spark.reducer.maxSizeInFlight              48m
spark.shuffle.file.buffer                  32k
spark.io.compression.codec                 org.apache.spark.io.LZ4CompressionCodec

# UI configuration
spark.ui.port                              4040
spark.ui.showConsoleProgress               true